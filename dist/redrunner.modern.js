const t=document,e=t=>void 0===t,s=t=>"string"==typeof t;function i(t){let e=document.createElement("template");return e.innerHTML=t,new n(e.content.firstChild)}function r(t,e,s,r){let h=new t(s,e,r);return h.__bv(h,i),h.init(),h.update(),h}class h{constructor(t,e,s){this.view=e,this.cls=t,this.cache={},this.keyFn=s||((t,e)=>e),this._seq=0}reset(){this._seq=0}get(t){let e,s=this.keyFn(t,this._seq);return this.cache.hasOwnProperty(s)?e=this.cache[s]:(e=r(this.cls,t,this.view,this._seq),this.cache[s]=e),e.update(t),this._seq+=1,e}}class n{constructor(t,e){this.e=t,this._c=void 0,this._n=void 0,this.view=e}append(t){return this._append(t)}_append(t){return this.e.appendChild(t.e)}child(t){return this.clear(),this._append(t)}replace(t){this.e.parentNode.replaceChild(t,this.e)}clear(){return this._n&&(this._n.length=0),this.e.innerHTML="",this.e.textContent="",this.e.value="",this}html(t){return this.e.innerHTML=t,this}inner(t){if(!Array.isArray(t))return this.child(t);this._prepRepeat();for(var e=0,s=t.length;e<s;e++)this._append(t[e]);return this._done()}items(t){let e;this._prepRepeat();for(var s=0,i=t.length;s<i;s++)e=this._c.get(t[s]),this._nest(e),this.e.appendChild(e.root.e);return this._done()}_nest(t){this._n||(this._n=this.view.__nv),this._n.push(t)}_prepRepeat(){this.visible(!1),this.clear()}_done(){return this.visible(!0),this}use(t){return this._c=new h(t,this),this}watch(t,s){let i,r,h=t.split(":");if(1===h.length)i=h[0],r=(t,e)=>s(t,e,this);else{let t=h[0];i=h[1],r=e(s)?e=>this[t](e):(e,i)=>this[t](s(e,i,this))}return this.view.watch(i,r),this}get Value(){return this.e.value}css(t){return this.e.className=t,this}cssAdd(t){return this.e.classList.add(t),this}cssAddTrans(t){return this.transition(e=>this.e.classList.add(t))}cssRemove(t){return this.e.classList.remove(t),this}cssRemoveTrans(t){return this.transition(e=>this.e.classList.remove(t))}cssToggle(t){return this.e.classList.toggle(t),this}att(t,e){return this.e.setAttribute(t,e),this}atts(t){for(let e in t)this.att(e,t[e]);return this}checked(t){return this.e.checked=t,this}href(t){return this.att("href",t)}id(t){return this.att("id",t)}src(t){return this.att("src",t)}value(t){return this.att("value",t)}text(t){return this.e.textContent=t,this}on(t,e){return this.e.addEventListener(t,t=>e(t,this)),this}style(t,e){return this.e.style[t]=e,this}transition(t){return new Promise(e=>{t();let s=t=>{this.e.removeEventListener("transitionend",s),e()};this.e.addEventListener("transitionend",s)})}visible(t){return this.style("visibility",t?"visible":"hidden")}}class a{constructor(t,e,s){this.__html__="<div/>";let i=this;i.parent=t,i.props=e,i.seq=s,i.__nv=[],i.__ov={},i.root=null,i.dom=null}init(){}update(t){e(t)||(this.props=t),this.__uw(),this.__un()}debug(){c.log(this.__bv.toString());let t=[];t.push("__wc: {");for(let[e,s]of Object.entries(this.__wc))t.push(`  "${e}": [`),s.forEach(e=>t.push("  "+e.toString())),t.push("  ]");t.push("}"),c.log(t.join("\n"))}nest(t,e,s){let i=r(t,e,this,s);return this.__nv.push(i),i}emit(t,s){let i=this;for(;!e(i);){let e=i._handlers_;if(t in e)return e[t].apply(i,s);i=i.parent}}old(t){return this.__ov[t]}watch(t,e){return this.__wc.hasOwnProperty(t)||(this.__wc[t]=[]),this.__wc[t].push(e),this}__gw(t){let e=t.reduce((t,e)=>t.childNodes[e],this.root.e);return new n(e,this)}__un(){this.__nv.forEach(t=>{t.__ia()&&t.update()})}__uw(){let t,e,s,i;for(t in this.__wc){if(e=this.__wq[t].apply(this),s=this.__ov[t],""===t||s!==e){i=this.__wc[t];for(var r=0,h=i.length;r<h;r++)i[r].apply(this,[e,s])}this.__ov[t]=e}}__rn(t,e){this.__gw(t).replace(e.root.e)}__ia(){return this.root.e.parentNode}}const o=t=>1;class l{constructor(t){this.resources=t.resources;let e,s=t.path;this._vc=new h(t.cls,this,t.keyFn||o),[s,e]=s.split("?"),this.chunks=this.buildChunks(s),this.params=this.buildParams(e),this.resolve=t.resolve||this.defautResolve}defautResolve(t){return Promise.resolve(t)}buildChunks(t){return t.split("/").map(t=>t.startsWith("{")?new u(t.slice(1,-1)):t)}buildParams(t){let e={};return t&&t.split(",").forEach(t=>{let s=new u(t.trim());e[s.name]=s}),e}getView(t){return this.resolve(t,this).then(t=>this._vc.get(t))}match(t){let e,i,r=this.chunks.length,h={};[e,...i]=t.split("?");let n=e.split("/");if(r!==n.length)return!1;for(let t=0;t<r;t++){let e=this.chunks[t],i=n[t];if(e instanceof u)h[e.name]=t=>e.convert(i);else if(s(e)&&e!=i)return!1}for(let t in h)h[t]=h[t]();let a={};return i&&i.join("").split("&").forEach(t=>{let e,s;[e,s]=t.split("="),a[e]=this.params.hasOwnProperty(e)?this.params[e].convert(s):s}),{args:h,params:a,url:t}}}class u{constructor(t){let e,s;switch([e,s]=t.split(":"),this.name=e,s){case"int":this.conv=t=>parseInt(t);break;case"float":this.conv=t=>parseFloat(t);break;default:this.conv=t=>t}}convert(t){return this.conv(t)}}module.exports={mount:function(e,i,h,n,a){let o=r(i,h,n,a),l=s(e)?t.getElementById(e.slice(1)):e;return l.parentNode.replaceChild(o.root.e,l),o},h:function(t,e){return new n(document.createElement(t)).inner(e)},Router:class extends a{init(){let{routes:t,resources:e}=this.props;if(this._routes=t.map(t=>new l(t)),this._resources={},e)for(let[t,s]of Object.entries(e))this._resources[t]={loaded:!1,func:s};window.addEventListener("hashchange",t=>this._hashChanged()),window.addEventListener("load",t=>this._hashChanged())}_resolveResources(t){let e=[];return t&&t.forEach(t=>{let s=this._resources[t];s.loaded||e.push(s.func(this))}),Promise.all(e)}_hashChanged(){let t=location.hash.slice(1)||"/";this._matchRoute(t)}_matchRoute(t){let e=this._routes.length,s=!1;for(let i=0;i<e;i++){let e=this._routes[i],r=e.match(t);if(r){s=!0,this._resolveResources(e.resources).then(t=>{e.getView(r).then(t=>{this.root.child(t.root)})});break}}if(!s)throw new Error("Route not matched: "+t)}},Store:class{constructor(t){this.nextId=1,this.change=0,this.items=[],this.hash={},this.load(t)}add(t){return Promise.resolve(this._add(t))}_add(t){return t.id=this.nextId,this.nextId++,this.items.push(t),this.hash[t.id]=t,t}update(t,e){let s=this.hash[t];return Object.assign(s,e,{id:t}),Promise.resolve(s)}get(t){return this.hash[t]}getItems(){return this.items}delete(t){return this.items=this.items.filter(e=>e.id!==t),delete this.hash[t],Promise.resolve(t)}load(t){t.forEach(t=>this._add(t))}},View:a,ViewCache:h,wrap:i};
//# sourceMappingURL=redrunner.modern.js.map
