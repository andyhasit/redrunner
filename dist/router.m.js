var t=function(t){return void 0===t};function n(t){var n=document.createElement("template");return n.innerHTML=t,new r(n.content.firstChild)}function e(t,e,i,r){var s=new t(i,e,r);return s.__bv(s,n),s.init(),s.update(),s}var i=function(){function t(t,n,e){this.view=n,this.cls=t,this.cache={},this.keyFn=e||function(t,n){return n},this._seq=0}var n=t.prototype;return n.reset=function(){this._seq=0},n.get=function(t){var n,i=this.keyFn(t,this._seq);return this.cache.hasOwnProperty(i)?n=this.cache[i]:(n=e(this.cls,t,this.view,this._seq),this.cache[i]=n),n.update(t),this._seq+=1,n},t}(),r=function(){function n(t,n){this.e=t,this._c=void 0,this._n=void 0,this.view=n}var e,r=n.prototype;return r.append=function(t){return this._append(t)},r._append=function(t){return this.e.appendChild(t.e)},r.child=function(t){return this.clear(),this._append(t)},r.replace=function(t){this.e.parentNode.replaceChild(t,this.e)},r.clear=function(){return this._n&&(this._n.length=0),this.e.innerHTML="",this.e.textContent="",this.e.value="",this},r.html=function(t){return this.e.innerHTML=t,this},r.inner=function(t){if(!Array.isArray(t))return this.child(t);this._prepRepeat();for(var n=0,e=t.length;n<e;n++)this._append(t[n]);return this._done()},r.items=function(t){var n;this._prepRepeat();for(var e=0,i=t.length;e<i;e++)n=this._c.get(t[e]),this._nest(n),this.e.appendChild(n.root.e);return this._done()},r._nest=function(t){this._n||(this._n=this.view.__nv),this._n.push(t)},r._prepRepeat=function(){this.visible(!1),this.clear()},r._done=function(){return this.visible(!0),this},r.use=function(t){return this._c=new i(t,this),this},r.watch=function(n,e){var i,r,s=this,o=n.split(":");if(1===o.length)i=o[0],r=function(t,n){return e(t,n,s)};else{var u=o[0];i=o[1],r=t(e)?function(t){return s[u](t)}:function(t,n){return s[u](e(t,n,s))}}return this.view.watch(i,r),this},r.css=function(t){return this.e.className=t,this},r.cssAdd=function(t){return this.e.classList.add(t),this},r.cssAddTrans=function(t){var n=this;return this.transition(function(e){return n.e.classList.add(t)})},r.cssRemove=function(t){return this.e.classList.remove(t),this},r.cssRemoveTrans=function(t){var n=this;return this.transition(function(e){return n.e.classList.remove(t)})},r.cssToggle=function(t){return this.e.classList.toggle(t),this},r.att=function(t,n){return this.e.setAttribute(t,n),this},r.atts=function(t){for(var n in t)this.att(n,t[n]);return this},r.checked=function(t){return this.e.checked=t,this},r.href=function(t){return this.att("href",t)},r.id=function(t){return this.att("id",t)},r.src=function(t){return this.att("src",t)},r.value=function(t){return this.att("value",t)},r.text=function(t){return this.e.textContent=t,this},r.on=function(t,n){var e=this;return this.e.addEventListener(t,function(t){return n(t,e)}),this},r.style=function(t,n){return this.e.style[t]=n,this},r.transition=function(t){var n=this;return new Promise(function(e){t(),n.e.addEventListener("transitionend",function t(i){n.e.removeEventListener("transitionend",t),e()})})},r.visible=function(t){return this.style("visibility",t?"visible":"hidden")},(e=[{key:"Value",get:function(){return this.e.value}}])&&function(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(n.prototype,e),n}(),s=function(t){return 1},o=function(t){var n,e;function i(){return t.apply(this,arguments)||this}e=t,(n=i).prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e;var r=i.prototype;return r.init=function(){var t=this,n=this.props,e=n.resources;if(this._routes=n.routes.map(function(t){return new u(t)}),this._resources={},e)for(var i=0,r=Object.entries(e);i<r.length;i++){var s=r[i];this._resources[s[0]]={loaded:!1,func:s[1]}}window.addEventListener("hashchange",function(n){return t._hashChanged()}),window.addEventListener("load",function(n){return t._hashChanged()})},r._resolveResources=function(t){var n=this,e=[];return t&&t.forEach(function(t){var i=n._resources[t];i.loaded||e.push(i.func(n))}),Promise.all(e)},r._hashChanged=function(){var t=location.hash.slice(1)||"/";this._matchRoute(t)},r._matchRoute=function(t){for(var n=this,e=this._routes.length,i=!1,r=function(e){var r=n._routes[e],s=r.match(t);if(s)return i=!0,n._resolveResources(r.resources).then(function(t){r.getView(s).then(function(t){n.root.child(t.root)})}),"break"},s=0;s<e&&"break"!==r(s);s++);if(!i)throw new Error("Route not matched: "+t)},i}(function(){function n(t,n,e){this.__html__="<div/>";var i=this;i.parent=t,i.props=n,i.seq=e,i.__nv=[],i.__ov={},i.root=null,i.dom=null}var i=n.prototype;return i.init=function(){},i.update=function(n){t(n)||(this.props=n),this.__uw(),this.__un()},i.debug=function(){c.log(this.__bv.toString());var t=[];t.push("__wc: {");for(var n=0,e=Object.entries(this.__wc);n<e.length;n++){var i=e[n],r=i[1];t.push('  "'+i[0]+'": ['),r.forEach(function(n){return t.push("  "+n.toString())}),t.push("  ]")}t.push("}"),c.log(t.join("\n"))},i.nest=function(t,n,i){var r=e(t,n,this,i);return this.__nv.push(r),r},i.emit=function(n,e){for(var i=this;!t(i);){var r=i._handlers_;if(n in r)return r[n].apply(i,e);i=i.parent}},i.old=function(t){return this.__ov[t]},i.watch=function(t,n){return this.__wc.hasOwnProperty(t)||(this.__wc[t]=[]),this.__wc[t].push(n),this},i.__gw=function(t){var n=t.reduce(function(t,n){return t.childNodes[n]},this.root.e);return new r(n,this)},i.__un=function(){this.__nv.forEach(function(t){t.__ia()&&t.update()})},i.__uw=function(){var t,n,e,i;for(t in this.__wc){if(n=this.__wq[t].apply(this),e=this.__ov[t],""===t||e!==n)for(var r=0,s=(i=this.__wc[t]).length;r<s;r++)i[r].apply(this,[n,e]);this.__ov[t]=n}},i.__rn=function(t,n){this.__gw(t).replace(n.root.e)},i.__ia=function(){return this.root.e.parentNode},n}()),u=function(){function t(t){this.resources=t.resources;var n,e=t.path;this._vc=new i(t.cls,this,t.keyFn||s);var r=e.split("?");n=r[1],this.chunks=this.buildChunks(e=r[0]),this.params=this.buildParams(n),this.resolve=t.resolve||this.defautResolve}var n=t.prototype;return n.defautResolve=function(t){return Promise.resolve(t)},n.buildChunks=function(t){return t.split("/").map(function(t){return t.startsWith("{")?new h(t.slice(1,-1)):t})},n.buildParams=function(t){var n={};return t&&t.split(",").forEach(function(t){var e=new h(t.trim());n[e.name]=e}),n},n.getView=function(t){var n=this;return this.resolve(t,this).then(function(t){return n._vc.get(t)})},n.match=function(t){var n,e,i=this,r=this.chunks.length,s={},o=t.split("?");n=o[0],e=o.slice(1);var u=n.split("/");if(r!==u.length)return!1;for(var c=function(t){var n=i.chunks[t],e=u[t];if(n instanceof h)s[n.name]=function(t){return n.convert(e)};else if("string"==typeof n&&n!=e)return{v:!1}},a=0;a<r;a++){var f=c(a);if("object"==typeof f)return f.v}for(var v in s)s[v]=s[v]();var l={};return e&&e.join("").split("&").forEach(function(t){var n,e,r=t.split("=");e=r[1],l[n=r[0]]=i.params.hasOwnProperty(n)?i.params[n].convert(e):e}),{args:s,params:l,url:t}},t}(),h=function(){function t(t){var n,e=t.split(":");switch(n=e[1],this.name=e[0],n){case"int":this.conv=function(t){return parseInt(t)};break;case"float":this.conv=function(t){return parseFloat(t)};break;default:this.conv=function(t){return t}}}return t.prototype.convert=function(t){return this.conv(t)},t}();export{u as Route,h as RouteArg,o as Router};
//# sourceMappingURL=router.m.js.map
